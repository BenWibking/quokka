/// \file planck_integral.hpp
/// \brief Some functions for quickly integrating the Planck function.

#include <algorithm>
#include <cmath>

#include "AMReX.H"
#include "AMReX_BLassert.H"
#include "AMReX_Extension.H"
#include "AMReX_GpuQualifiers.H"
#include "AMReX_REAL.H"

#include "valarray.hpp"
// #include "interpolate.cpp"

#define LIKELY_IN_CACHE_SIZE 8

using Real = amrex::Real;

static constexpr double PI = 3.14159265358979323846;
static constexpr double gInf = PI * PI * PI * PI / 15.0;
static constexpr int INTERP_SIZE = 1000;
static constexpr amrex::GpuArray<double, INTERP_SIZE> X_interp{
    1.00000000000000e-03, 1.01159111222383e-03, 1.02331657833024e-03, 1.03517795563018e-03, 1.04717681948552e-03, 1.05931476351837e-03, 1.07159339982267e-03,
    1.08401435917833e-03, 1.09657929126781e-03, 1.10928986489522e-03, 1.12214776820798e-03, 1.13515470892100e-03, 1.14831241454351e-03, 1.16162263260850e-03,
    1.17508713090481e-03, 1.18870769771190e-03, 1.20248614203741e-03, 1.21642429385737e-03, 1.23052400435926e-03, 1.24478714618791e-03, 1.25921561369415e-03,
    1.27381132318648e-03, 1.28857621318552e-03, 1.30351224468151e-03, 1.31862140139475e-03, 1.33390569003906e-03, 1.34936714058831e-03, 1.36500780654601e-03,
    1.38082976521809e-03, 1.39683511798874e-03, 1.41302599059953e-03, 1.42940453343176e-03, 1.44597292179202e-03, 1.46273335620113e-03, 1.47968806268640e-03,
    1.49683929307726e-03, 1.51418932530435e-03, 1.53174046370208e-03, 1.54949503931463e-03, 1.56745541020559e-03, 1.58562396177114e-03, 1.60400310705682e-03,
    1.62259528707809e-03, 1.64140297114447e-03, 1.66042865718753e-03, 1.67967487209265e-03, 1.69914417203463e-03, 1.71883914281715e-03, 1.73876240021625e-03,
    1.75891659032773e-03, 1.77930438991858e-03, 1.79992850678248e-03, 1.82079168009946e-03, 1.84189668079971e-03, 1.86324631193156e-03, 1.88484340903380e-03,
    1.90669084051225e-03, 1.92879150802078e-03, 1.95114834684662e-03, 1.97376432630026e-03, 1.99664245010979e-03, 2.01978575681988e-03, 2.04319732019527e-03,
    2.06688024962908e-03, 2.09083769055575e-03, 2.11507282486879e-03, 2.13958887134342e-03, 2.16438908606402e-03, 2.18947676285662e-03, 2.21485523372636e-03,
    2.24052786930002e-03, 2.26649807927369e-03, 2.29276931286565e-03, 2.31934505927443e-03, 2.34622884814226e-03, 2.37342425002387e-03, 2.40093487686065e-03,
    2.42876438246045e-03, 2.45691646298279e-03, 2.48539485742980e-03, 2.51420334814280e-03, 2.54334576130465e-03, 2.57282596744793e-03, 2.60264788196900e-03,
    2.63281546564802e-03, 2.66333272517498e-03, 2.69420371368188e-03, 2.72543253128103e-03, 2.75702332560958e-03, 2.78898029238044e-03, 2.82130767593947e-03,
    2.85400976982924e-03, 2.88709091735923e-03, 2.92055551218275e-03, 2.95440799888038e-03, 2.98865287355038e-03, 3.02329468440578e-03, 3.05833803237843e-03,
    3.09378757173014e-03, 3.12964801067075e-03, 3.16592411198352e-03, 3.20262069365765e-03, 3.23974262952820e-03, 3.27729484992338e-03, 3.31528234231942e-03,
    3.35371015200293e-03, 3.39258338274099e-03, 3.43190719745904e-03, 3.47168681892656e-03, 3.51192753045073e-03, 3.55263467657814e-03, 3.59381366380463e-03,
    3.63546996129332e-03, 3.67760910160103e-03, 3.72023668141307e-03, 3.76335836228653e-03, 3.80697987140228e-03, 3.85110700232557e-03, 3.89574561577550e-03,
    3.94090164040345e-03, 3.98658107358044e-03, 4.03278998219371e-03, 4.07953450345245e-03, 4.12682084570295e-03, 4.17465528925313e-03, 4.22304418720667e-03,
    4.27199396630678e-03, 4.32151112778976e-03, 4.37160224824850e-03, 4.42227398050590e-03, 4.47353305449846e-03, 4.52538627817017e-03, 4.57784053837662e-03,
    4.63090280179974e-03, 4.68458011587305e-03, 4.73887960971765e-03, 4.79380849508911e-03, 4.84937406733523e-03, 4.90558370636505e-03, 4.96244487762891e-03,
    5.01996513311008e-03, 5.07815211232767e-03, 5.13701354335134e-03, 5.19655724382766e-03, 5.25679112201842e-03, 5.31772317785097e-03, 5.37936150398070e-03,
    5.44171428686589e-03, 5.50478980785497e-03, 5.56859644428641e-03, 5.63314267060135e-03, 5.69843705946914e-03, 5.76448828292587e-03, 5.83130511352622e-03,
    5.89889642550849e-03, 5.96727119597331e-03, 6.03643850607586e-03, 6.10640754223204e-03, 6.17718759733849e-03, 6.24878807200689e-03, 6.32121847581245e-03,
    6.39448842855694e-03, 6.46860766154633e-03, 6.54358601888324e-03, 6.61943345877439e-03, 6.69616005485322e-03, 6.77377599751775e-03, 6.85229159528406e-03,
    6.93171727615541e-03, 7.01206358900718e-03, 7.09334120498800e-03, 7.17556091893693e-03, 7.25873365081725e-03, 7.34287044716677e-03, 7.42798248256492e-03,
    7.51408106111697e-03, 7.60117761795533e-03, 7.68928372075831e-03, 7.77841107128649e-03, 7.86857150693685e-03, 7.95977700231499e-03, 8.05203967082548e-03,
    8.14537176628075e-03, 8.23978568452852e-03, 8.33529396509820e-03, 8.43190929286626e-03, 8.52964449974103e-03, 8.62851256636690e-03, 8.72852662384838e-03,
    8.82969995549409e-03, 8.93204599858097e-03, 9.03557834613893e-03, 9.14031074875623e-03, 9.24625711640574e-03, 9.35343152029239e-03, 9.46184819472200e-03,
    9.57152153899187e-03, 9.68246611930312e-03, 9.79469667069540e-03, 9.90822809900380e-03, 1.00230754828387e-02, 1.01392540755882e-02, 1.02567793074442e-02,
    1.03756667874519e-02, 1.04959323055823e-02, 1.06175918348300e-02, 1.07406615333343e-02, 1.08651577465254e-02, 1.09910970092950e-02, 1.11184960481927e-02,
    1.12473717836475e-02, 1.13777413322149e-02, 1.15096220088503e-02, 1.16430313292088e-02, 1.17779870119712e-02, 1.19145069811978e-02, 1.20526093687084e-02,
    1.21923125164911e-02, 1.23336349791378e-02, 1.24765955263087e-02, 1.26212131452255e-02, 1.27675070431927e-02, 1.29154966501488e-02, 1.30652016212472e-02,
    1.32166418394661e-02, 1.33698374182495e-02, 1.35248087041788e-02, 1.36815762796747e-02, 1.38401609657313e-02, 1.40005838246810e-02, 1.41628661629920e-02,
    1.43270295340983e-02, 1.44930957412622e-02, 1.46610868404698e-02, 1.48310251433610e-02, 1.50029332201922e-02, 1.51768339028341e-02, 1.53527502878042e-02,
    1.55307057393346e-02, 1.57107238924745e-02, 1.58928286562298e-02, 1.60770442167382e-02, 1.62633950404819e-02, 1.64519058775366e-02, 1.66426017648590e-02,
    1.68355080296120e-02, 1.70306502925284e-02, 1.72280544713139e-02, 1.74277467840892e-02, 1.76297537528721e-02, 1.78341022071001e-02, 1.80408192871938e-02,
    1.82499324481615e-02, 1.84614694632455e-02, 1.86754584276108e-02, 1.88919277620767e-02, 1.91109062168914e-02, 1.93324228755505e-02, 1.95565071586595e-02,
    1.97831888278416e-02, 2.00124979896904e-02, 2.02444650997680e-02, 2.04791209666509e-02, 2.07164967560207e-02, 2.09566239948043e-02, 2.11995345753607e-02,
    2.14452607597167e-02, 2.16938351838518e-02, 2.19452908620331e-02, 2.21996611911995e-02, 2.24569799553977e-02, 2.27172813302691e-02, 2.29805998875885e-02,
    2.32469705998565e-02, 2.35164288449435e-02, 2.37890104107889e-02, 2.40647515001542e-02, 2.43436887354311e-02, 2.46258591635055e-02, 2.49113002606779e-02,
    2.52000499376409e-02, 2.54921465445142e-02, 2.57876288759380e-02, 2.60865361762255e-02, 2.63889081445751e-02, 2.66947849403432e-02, 2.70042071883777e-02,
    2.73172159844138e-02, 2.76338529005317e-02, 2.79541599906786e-02, 2.82781797962534e-02, 2.86059553517574e-02, 2.89375301905095e-02, 2.92729483504282e-02,
    2.96122543798803e-02, 2.99554933435981e-02, 3.03027108286640e-02, 3.06539529505653e-02, 3.10092663593193e-02, 3.13686982456688e-02, 3.17322963473498e-02,
    3.21001089554317e-02, 3.24721849207313e-02, 3.28485736603004e-02, 3.32293251639897e-02, 3.36144900010876e-02, 3.40041193270371e-02, 3.43982648902292e-02,
    3.47969790388769e-02, 3.52003147279668e-02, 3.56083255262928e-02, 3.60210656235707e-02, 3.64385898376354e-02, 3.68609536217216e-02, 3.72882130718283e-02,
    3.77204249341700e-02, 3.81576466127125e-02, 3.85999361767977e-02, 3.90473523688556e-02, 3.94999546122064e-02, 3.99578030189527e-02, 4.04209583979631e-02,
    4.08894822629486e-02, 4.13634368406328e-02, 4.18428850790158e-02, 4.23278906557355e-02, 4.28185179865241e-02, 4.33148322337640e-02, 4.38168993151419e-02,
    4.43247859124040e-02, 4.48385594802119e-02, 4.53582882551019e-02, 4.58840412645476e-02, 4.64158883361278e-02, 4.69539001068006e-02, 4.74981480322850e-02,
    4.80487043965513e-02, 4.86056423214214e-02, 4.91690357762803e-02, 4.97389595879007e-02, 5.03154894503805e-02, 5.08987019351968e-02, 5.14886745013749e-02,
    5.20854855057766e-02, 5.26892142135067e-02, 5.32999408084409e-02, 5.39177464038750e-02, 5.45427130532983e-02, 5.51749237612913e-02, 5.58144624945496e-02,
    5.64614141930367e-02, 5.71158647812643e-02, 5.77779011797050e-02, 5.84476113163363e-02, 5.91250841383188e-02, 5.98104096238094e-02, 6.05036787939122e-02,
    6.12049837247670e-02, 6.19144175597784e-02, 6.26320745219869e-02, 6.33580499265825e-02, 6.40924401935645e-02, 6.48353428605472e-02, 6.55868565957143e-02,
    6.63470812109235e-02, 6.71161176749628e-02, 6.78940681269611e-02, 6.86810358899530e-02, 6.94771254846024e-02, 7.02824426430835e-02, 7.10970943231243e-02,
    7.19211887222119e-02, 7.27548352919623e-02, 7.35981447526577e-02, 7.44512291079514e-02, 7.53142016597437e-02, 7.61871770232300e-02, 7.70702711421230e-02,
    7.79636013040523e-02, 7.88672861561415e-02, 7.97814457207662e-02, 8.07062014114950e-02, 8.16416760492147e-02, 8.25879938784427e-02, 8.35452805838287e-02,
    8.45136633068472e-02, 8.54932706626838e-02, 8.64842327573172e-02, 8.74866812047991e-02, 8.85007491447343e-02, 8.95265712599640e-02, 9.05642837944529e-02,
    9.16140245713852e-02, 9.26759330114688e-02, 9.37501501514528e-02, 9.48368186628592e-02, 9.59360828709314e-02, 9.70480887738030e-02, 9.81729840618884e-02,
    9.93109181374980e-02, 1.00462042134681e-01, 1.01626508939300e-01, 1.02804473209331e-01, 1.03996091395412e-01, 1.05201521761616e-01, 1.06420924406472e-01,
    1.07654461284232e-01, 1.08902296226373e-01, 1.10164594963366e-01, 1.11441525146679e-01, 1.12733256371049e-01, 1.14039960197003e-01, 1.15361810173648e-01,
    1.16698981861715e-01, 1.18051652856881e-01, 1.19420002813353e-01, 1.20804213467733e-01, 1.22204468663149e-01, 1.23620954373677e-01, 1.25053858729039e-01,
    1.26503372039590e-01, 1.27969686821594e-01, 1.29452997822792e-01, 1.30953502048267e-01, 1.32471398786612e-01, 1.34006889636395e-01, 1.35560178532937e-01,
    1.37131471775395e-01, 1.38720978054162e-01, 1.40328908478587e-01, 1.41955476605010e-01, 1.43600898465126e-01, 1.45265392594678e-01, 1.46949180062482e-01,
    1.48652484499786e-01, 1.50375532129974e-01, 1.52118551798610e-01, 1.53881775003835e-01, 1.55665435927106e-01, 1.57469771464309e-01, 1.59295021257212e-01,
    1.61141427725302e-01, 1.63009236097974e-01, 1.64898694447107e-01, 1.66810053720006e-01, 1.68743567772738e-01, 1.70699493403841e-01, 1.72678090388436e-01,
    1.74679621512725e-01, 1.76704352608895e-01, 1.78752552590424e-01, 1.80824493487795e-01, 1.82920450484629e-01, 1.85040701954230e-01, 1.87185529496558e-01,
    1.89355217975630e-01, 1.91550055557353e-01, 1.93770333747799e-01, 1.96016347431919e-01, 1.98288394912707e-01, 2.00586777950823e-01, 2.02911801804668e-01,
    2.05263775270925e-01, 2.07643010725577e-01, 2.10049824165392e-01, 2.12484535249888e-01, 2.14947467343798e-01, 2.17438947560008e-01, 2.19959306803007e-01,
    2.22508879812837e-01, 2.25088005209546e-01, 2.27697025538168e-01, 2.30336287314213e-01, 2.33006141069692e-01, 2.35706941399673e-01, 2.38439047009372e-01,
    2.41202820761801e-01, 2.43998629725955e-01, 2.46826845225569e-01, 2.49687842888433e-01, 2.52582002696278e-01, 2.55509709035251e-01, 2.58471350746956e-01,
    2.61467321180109e-01, 2.64498018242772e-01, 2.67563844455205e-01, 2.70665207003324e-01, 2.73802517792786e-01, 2.76976193503689e-01, 2.80186655645920e-01,
    2.83434330615131e-01, 2.86719649749377e-01, 2.90043049386399e-01, 2.93404970921579e-01, 2.96805860866560e-01, 3.00246170908555e-01, 3.03726357970331e-01,
    3.07246884270900e-01, 3.10808217386906e-01, 3.14410830314726e-01, 3.18055201533292e-01, 3.21741815067637e-01, 3.25471160553185e-01, 3.29243733300777e-01,
    3.33060034362459e-01, 3.36920570598027e-01, 3.40825854742345e-01, 3.44776405473446e-01, 3.48772747481418e-01, 3.52815411538088e-01, 3.56904934567523e-01,
    3.61041859717334e-01, 3.65226736430818e-01, 3.69460120519930e-01, 3.73742574239106e-01, 3.78074666359935e-01, 3.82456972246700e-01, 3.86890073932798e-01,
    3.91374560198038e-01, 3.95911026646846e-01, 4.00500075787361e-01, 4.05142317111465e-01, 4.09838367175726e-01, 4.14588849683291e-01, 4.19394395566719e-01,
    4.24255643071778e-01, 4.29173237842216e-01, 4.34147833005509e-01, 4.39180089259609e-01, 4.44270674960688e-01, 4.49420266211914e-01, 4.54629546953240e-01,
    4.59899209052244e-01, 4.65229952396019e-01, 4.70622484984128e-01, 4.76077523022637e-01, 4.81595791019235e-01, 4.87178021879463e-01, 4.92824957004051e-01,
    4.98537346387389e-01, 5.04315948717136e-01, 5.10161531474983e-01, 5.16074871038591e-01, 5.22056752784698e-01, 5.28107971193433e-01, 5.34229329953835e-01,
    5.40421642070592e-01, 5.46685729972018e-01, 5.53022425619290e-01, 5.59432570616938e-01, 5.65917016324624e-01, 5.72476623970218e-01, 5.79112264764176e-01,
    5.85824820015254e-01, 5.92615181247555e-01, 5.99484250318941e-01, 6.06432939540806e-01, 6.13462171799251e-01, 6.20572880677650e-01, 6.27766010580650e-01,
    6.35042516859596e-01, 6.42403365939419e-01, 6.49849535446989e-01, 6.57382014340959e-01, 6.65001803043112e-01, 6.72709913571234e-01, 6.80507369673521e-01,
    6.88395206964550e-01, 6.96374473062822e-01, 7.04446227729904e-01, 7.12611543011175e-01, 7.20871503378214e-01, 7.29227205872831e-01, 7.37679760252773e-01,
    7.46230289139111e-01, 7.54879928165343e-01, 7.63629826128224e-01, 7.72481145140340e-01, 7.81435060784454e-01, 7.90492762269642e-01, 7.99655452589235e-01,
    8.08924348680594e-01, 8.18300681586739e-01, 8.27785696619847e-01, 8.37380653526649e-01, 8.47086826655740e-01, 8.56905505126835e-01, 8.66837993001977e-01,
    8.76885609458743e-01, 8.87049688965440e-01, 8.97331581458352e-01, 9.07732652521022e-01, 9.18254283565628e-01, 9.28897872016450e-01, 9.39664831495469e-01,
    9.50556592010119e-01, 9.61574600143210e-01, 9.72720319245054e-01, 9.83995229627823e-01, 9.95400828762152e-01, 1.00693863147603e+00, 1.01861017015598e+00,
    1.03041699495059e+00, 1.04236067397640e+00, 1.05444279352617e+00, 1.06666495827954e+00, 1.07902879151618e+00, 1.09153593533139e+00, 1.10418805085416e+00,
    1.11698681846782e+00, 1.12993393803322e+00, 1.14303112911448e+00, 1.15628013120738e+00, 1.16968270397038e+00, 1.18324062745838e+00, 1.19695570235904e+00,
    1.21082975023204e+00, 1.22486461375093e+00, 1.23906215694792e+00, 1.25342426546140e+00, 1.26795284678643e+00, 1.28264983052806e+00, 1.29751716865759e+00,
    1.31255683577184e+00, 1.32777082935543e+00, 1.34316117004602e+00, 1.35872990190271e+00, 1.37447909267754e+00, 1.39041083409007e+00, 1.40652724210524e+00,
    1.42283045721435e+00, 1.43932264471941e+00, 1.45600599502065e+00, 1.47288272390750e+00, 1.48995507285285e+00, 1.50722530931076e+00, 1.52469572701757e+00,
    1.54236864629663e+00, 1.56024641436637e+00, 1.57833140565212e+00, 1.59662602210143e+00, 1.61513269350309e+00, 1.63385387780986e+00, 1.65279206146490e+00,
    1.67194975973199e+00, 1.69132951702965e+00, 1.71093390726902e+00, 1.73076553419573e+00, 1.75082703173573e+00, 1.77112106434509e+00, 1.79165032736390e+00,
    1.81241754737424e+00, 1.83342548256229e+00, 1.85467692308470e+00, 1.87617469143912e+00, 1.89792164283910e+00, 1.91992066559328e+00, 1.94217468148903e+00,
    1.96468664618045e+00, 1.98745954958098e+00, 2.01049641626050e+00, 2.03380030584698e+00, 2.05737431343291e+00, 2.08122156998634e+00, 2.10534524276671e+00,
    2.12974853574552e+00, 2.15443469003188e+00, 2.17940698430296e+00, 2.20466873523941e+00, 2.23022329796594e+00, 2.25607406649686e+00, 2.28222447418690e+00,
    2.30867799418717e+00, 2.33543813990648e+00, 2.36250846547795e+00, 2.38989256623105e+00, 2.41759407916913e+00, 2.44561668345245e+00, 2.47396410088681e+00,
    2.50264009641792e+00, 2.53164847863136e+00, 2.56099310025846e+00, 2.59067785868801e+00, 2.62070669648385e+00, 2.65108360190854e+00, 2.68181260945302e+00,
    2.71289780037247e+00, 2.74434330322837e+00, 2.77615329443680e+00, 2.80833199882317e+00, 2.84088369018330e+00, 2.87381269185107e+00, 2.90712337727258e+00,
    2.94082017058706e+00, 2.97490754721444e+00, 3.00939003444972e+00, 3.04427221206430e+00, 3.07955871291423e+00, 3.11525422355549e+00, 3.15136348486648e+00,
    3.18789129267765e+00, 3.22484249840844e+00, 3.26222200971167e+00, 3.30003479112529e+00, 3.33828586473176e+00, 3.37698031082509e+00, 3.41612326858553e+00,
    3.45571993676214e+00, 3.49577557436328e+00, 3.53629550135504e+00, 3.57728509936787e+00, 3.61874981241128e+00, 3.66069514759690e+00, 3.70312667586993e+00,
    3.74605003274899e+00, 3.78947091907467e+00, 3.83339510176660e+00, 3.87782841458946e+00, 3.92277675892772e+00, 3.96824610456948e+00, 4.01424249049932e+00,
    4.06077202570037e+00, 4.10784088996565e+00, 4.15545533471888e+00, 4.20362168384471e+00, 4.25234633452868e+00, 4.30163575810680e+00, 4.35149650092505e+00,
    4.40193518520887e+00, 4.45295850994265e+00, 4.50457325175946e+00, 4.55678626584106e+00, 4.60960448682843e+00, 4.66303492974273e+00, 4.71708469091702e+00,
    4.77176094893875e+00, 4.82707096560318e+00, 4.88302208687788e+00, 4.93962174387832e+00, 4.99687745385488e+00, 5.05479682119124e+00, 5.11338753841433e+00,
    5.17265738721602e+00, 5.23261423948666e+00, 5.29326605836056e+00, 5.35462089927361e+00, 5.41668691103315e+00, 5.47947233690029e+00, 5.54298551568467e+00,
    5.60723488285203e+00, 5.67222897164454e+00, 5.73797641421413e+00, 5.80448594276898e+00, 5.87176639073326e+00, 5.93982669392036e+00, 6.00867589171969e+00,
    6.07832312829723e+00, 6.14877765381002e+00, 6.22004882563471e+00, 6.29214610961034e+00, 6.36507908129557e+00, 6.43885742724042e+00, 6.51349094627280e+00,
    6.58898955079995e+00, 6.66536326812491e+00, 6.74262224177834e+00, 6.82077673286568e+00, 6.89983712143002e+00, 6.97981390783066e+00, 7.06071771413777e+00,
    7.14255928554313e+00, 7.22534949178721e+00, 7.30909932860291e+00, 7.39381991917587e+00, 7.47952251562182e+00, 7.56621850048105e+00, 7.65391938823015e+00,
    7.74263682681127e+00, 7.83238259917920e+00, 7.92316862486625e+00, 8.01500696156540e+00, 8.10790980673169e+00, 8.20188949920220e+00, 8.29695852083491e+00,
    8.39312949816637e+00, 8.49041520408875e+00, 8.58882855954625e+00, 8.68838263525118e+00, 8.78909065341995e+00, 8.89096598952916e+00, 8.99402217409204e+00,
    9.09827289445556e+00, 9.20373199661822e+00, 9.31041348706908e+00, 9.41833153464795e+00, 9.52750047242729e+00, 9.63793479961579e+00, 9.74964918348409e+00,
    9.86265846131282e+00, 9.97697764236320e+00, 1.00926219098705e+01, 1.02096066230605e+01, 1.03279473191895e+01, 1.04476597156081e+01, 1.05687597118481e+01,
    1.06912633917348e+01, 1.08151870255229e+01, 1.09405470720574e+01, 1.10673601809597e+01, 1.11956431948388e+01, 1.13254131515281e+01, 1.14566872863487e+01,
    1.15894830343981e+01, 1.17238180328660e+01, 1.18597101233767e+01, 1.19971773543589e+01, 1.21362379834424e+01, 1.22769104798836e+01, 1.24192135270178e+01,
    1.25631660247412e+01, 1.27087870920206e+01, 1.28560960694330e+01, 1.30051125217341e+01, 1.31558562404571e+01, 1.33083472465408e+01, 1.34626057929891e+01,
    1.36186523675608e+01, 1.37765076954905e+01, 1.39361927422414e+01, 1.40977287162897e+01, 1.42611370719413e+01, 1.44264395121816e+01, 1.45936579915576e+01,
    1.47628147190939e+01, 1.49339321612425e+01, 1.51070330448666e+01, 1.52821403602587e+01, 1.54592773641948e+01, 1.56384675830225e+01, 1.58197348157860e+01,
    1.60031031373870e+01, 1.61885969017820e+01, 1.63762407452169e+01, 1.65660595894992e+01, 1.67580786453077e+01, 1.69523234155412e+01, 1.71488196987054e+01,
    1.73475935923393e+01, 1.75486714964815e+01, 1.77520801171764e+01, 1.79578464700210e+01, 1.81659978837533e+01, 1.83765620038817e+01, 1.85895667963569e+01,
    1.88050405512858e+01, 1.90230118866895e+01, 1.92435097523033e+01, 1.94665634334226e+01, 1.96922025547917e+01, 1.99204570845387e+01, 2.01513573381556e+01,
    2.03849339825246e+01, 2.06212180399914e+01, 2.08602408924850e+01, 2.11020342856860e+01, 2.13466303332425e+01, 2.15940615210357e+01, 2.18443607114943e+01,
    2.20975611479590e+01, 2.23536964590980e+01, 2.26128006633728e+01, 2.28749081735570e+01, 2.31400538013065e+01, 2.34082727617829e+01, 2.36796006783308e+01,
    2.39540735872088e+01, 2.42317279423760e+01, 2.45126006203334e+01, 2.47967289250216e+01, 2.50841505927754e+01, 2.53749037973357e+01, 2.56690271549195e+01,
    2.59665597293487e+01, 2.62675410372384e+01, 2.65720110532451e+01, 2.68800102153761e+01, 2.71915794303602e+01, 2.75067600790807e+01, 2.78255940220713e+01,
    2.81481236050758e+01, 2.84743916646725e+01, 2.88044415339630e+01, 2.91383170483279e+01, 2.94760625512486e+01, 2.98177229001967e+01, 3.01633434725920e+01,
    3.05129701718287e+01, 3.08666494333727e+01, 3.12244282309286e+01, 3.15863540826782e+01, 3.19524750575921e+01, 3.23228397818138e+01, 3.26974974451177e+01,
    3.30764978074424e+01, 3.34598912054998e+01, 3.38477285594598e+01, 3.42400613797143e+01, 3.46369417737173e+01, 3.50384224529068e+01, 3.54445567397044e+01,
    3.58553985745982e+01, 3.62710025233065e+01, 3.66914237840249e+01, 3.71167181947577e+01, 3.75469422407334e+01, 3.79821530619074e+01, 3.84224084605506e+01,
    3.88677669089267e+01, 3.93182875570577e+01, 3.97740302405804e+01, 4.02350554886929e+01, 4.07014245321944e+01, 4.11731993116168e+01, 4.16504424854518e+01,
    4.21332174384729e+01, 4.26215882901532e+01, 4.31156199031823e+01, 4.36153778920801e+01, 4.41209286319119e+01, 4.46323392671040e+01, 4.51496777203610e+01,
    4.56730127016875e+01, 4.62024137175131e+01, 4.67379510799246e+01, 4.72796959160039e+01, 4.78277201772749e+01, 4.83820966492596e+01, 4.89428989611453e+01,
    4.95102015955635e+01, 5.00840798984821e+01, 5.06646100892127e+01, 5.12518692705333e+01, 5.18459354389291e+01, 5.24468874949512e+01, 5.30548052536957e+01,
    5.36697694554048e+01, 5.42918617761894e+01, 5.49211648388779e+01, 5.55577622239888e+01, 5.62017384808319e+01, 5.68531791387375e+01, 5.75121707184161e+01,
    5.81788007434494e+01, 5.88531577519145e+01, 5.95353313081437e+01, 6.02254120146193e+01, 6.09234915240071e+01, 6.16296625513294e+01, 6.23440188862786e+01,
    6.30666554056741e+01, 6.37976680860628e+01, 6.45371540164670e+01, 6.52852114112785e+01, 6.60419396233031e+01, 6.68074391569561e+01, 6.75818116816111e+01,
    6.83651600451024e+01, 6.91575882873853e+01, 6.99592016543537e+01, 7.07701066118189e+01, 7.15904108596489e+01, 7.24202233460732e+01, 7.32596542821523e+01,
    7.41088151564157e+01, 7.49678187496688e+01, 7.58367791499719e+01, 7.67158117677930e+01, 7.76050333513357e+01, 7.85045620020451e+01, 7.94145171902934e+01,
    8.03350197712473e+01, 8.12661920009195e+01, 8.22081575524054e+01, 8.31610415323096e+01, 8.41249704973612e+01, 8.51000724712225e+01, 8.60864769614925e+01,
    8.70843149769072e+01, 8.80937190447399e+01, 8.91148232284020e+01, 9.01477631452492e+01, 9.11926759845930e+01, 9.22497005259217e+01, 9.33189771573324e+01,
    9.44006478941760e+01, 9.54948563979197e+01, 9.66017479952265e+01, 9.77214696972572e+01, 9.88541702191957e+01, 1.00000000000000e+02};
static constexpr amrex::GpuArray<double, INTERP_SIZE> Y_interp{
    3.33208350000010e-10, 3.44928439096200e-10, 3.57060746231957e-10, 3.69619769058376e-10, 3.82620515067006e-10, 3.96078519517337e-10, 4.10009863995011e-10,
    4.24431195622159e-10, 4.39359746943423e-10, 4.54813356510919e-10, 4.70810490193028e-10, 4.87370263232280e-10, 5.04512463078796e-10, 5.22257573026384e-10,
    5.40626796679774e-10, 5.59642083281683e-10, 5.79326153930806e-10, 5.99702528721012e-10, 6.20795554834866e-10, 6.42630435624893e-10, 6.65233260716799e-10,
    6.88631037171632e-10, 7.12851721742690e-10, 7.37924254266746e-10, 7.63878592229335e-10, 7.90745746544706e-10, 8.18557818593682e-10, 8.47348038563870e-10,
    8.77150805136906e-10, 9.08001726571802e-10, 9.39937663231312e-10, 9.72996771604276e-10, 1.00721854987449e-09, 1.04264388509229e-09, 1.07931510200322e-09,
    1.11727601359401e-09, 1.15657197341488e-09, 1.19724992974070e-09, 1.23935848163641e-09, 1.28294793699276e-09, 1.32807037260193e-09, 1.37477969634515e-09,
    1.42313171156555e-09, 1.47318418370403e-09, 1.52499690927684e-09, 1.57863178727795e-09, 1.63415289309047e-09, 1.69162655499674e-09, 1.75112143337633e-09,
    1.81270860268801e-09, 1.87646163633339e-09, 1.94245669450264e-09, 2.01077261510743e-09, 2.08149100791004e-09, 2.15469635196070e-09, 2.23047609645809e-09,
    2.30892076515599e-09, 2.39012406443799e-09, 2.47418299519028e-09, 2.56119796860646e-09, 2.65127292606113e-09, 2.74451546319705e-09, 2.84103695837117e-09,
    2.94095270561574e-09, 3.04438205227166e-09, 3.15144854145673e-09, 3.26228005954178e-09, 3.37700898880745e-09, 3.49577236546628e-09, 3.61871204323661e-09,
    3.74597486266373e-09, 3.87771282639155e-09, 4.01408328059093e-09, 4.15524910276436e-09, 4.30137889614750e-09, 4.45264719094296e-09, 4.60923465262228e-09,
    4.77132829754719e-09, 4.93912171616666e-09, 5.11281530405505e-09, 5.29261650106652e-09, 5.47874003889254e-09, 5.67140819731582e-09, 5.87085106946591e-09,
    6.07730683639362e-09, 6.29102205129235e-09, 6.51225193370087e-09, 6.74126067404448e-09, 6.97832174887061e-09, 7.22371824716057e-09, 7.47774320810080e-09,
    7.74069997072083e-09, 8.01290253581186e-09, 8.29467594055641e-09, 8.58635664631773e-09, 8.88829294004973e-09, 9.20084534980385e-09, 9.52438707483223e-09,
    9.85930443079352e-09, 1.02059973105985e-08, 1.05648796614358e-08, 1.09363799785554e-08, 1.13209418163902e-08, 1.17190243176277e-08, 1.21311027608621e-08,
    1.25576691274780e-08, 1.29992326884401e-08, 1.34563206116886e-08, 1.39294785908621e-08, 1.44192714961005e-08, 1.49262840476959e-08, 1.54511215133969e-08,
    1.59944104302017e-08, 1.65567993514864e-08, 1.71389596203705e-08, 1.77415861702333e-08, 1.83653983533317e-08, 1.90111407985157e-08, 1.96795842990488e-08,
    2.03715267316008e-08, 2.10877940074979e-08, 2.18292410573702e-08, 2.25967528503609e-08, 2.33912454491121e-08, 2.42136671017842e-08, 2.50649993724042e-08,
    2.59462583108913e-08, 2.68584956641459e-08, 2.78028001296496e-08, 2.87802986530606e-08, 2.97921577713461e-08, 3.08395850030630e-08, 3.19238302874182e-08,
    3.30461874738345e-08, 3.42079958637907e-08, 3.54106418067667e-08, 3.66555603521857e-08, 3.79442369593296e-08, 3.92782092672459e-08, 4.06590689267598e-08,
    4.20884634967612e-08, 4.35680984070293e-08, 4.50997389899122e-08, 4.66852125832901e-08, 4.83264107073128e-08, 5.00252913174994e-08, 5.17838811368729e-08,
    5.36042780699057e-08, 5.54886537011396e-08, 5.74392558814428e-08, 5.94584114049871e-08, 6.15485287801120e-08, 6.37121010973702e-08, 6.59517089981604e-08,
    6.82700237474681e-08, 7.06698104143693e-08, 7.31539311640578e-08, 7.57253486653182e-08, 7.83871296174810e-08, 8.11424484010414e-08, 8.39945908562823e-08,
    8.69469581943732e-08, 9.00030710455996e-08, 9.31665736495065e-08, 9.64412381919419e-08, 9.98309692941291e-08, 1.03339808659111e-07, 1.06971939881050e-07,
    1.10731693423113e-07, 1.14623551769811e-07, 1.18652154759940e-07, 1.22822305106409e-07, 1.27138974109508e-07, 1.31607307570400e-07, 1.36232631911831e-07,
    1.41020460513300e-07, 1.45976500268218e-07, 1.51106658370807e-07, 1.56417049340779e-07, 1.61914002294121e-07, 1.67604068468582e-07, 1.73494029012792e-07,
    1.79590903048218e-07, 1.85901956013499e-07, 1.92434708301061e-07, 1.99196944196202e-07, 2.06196721129232e-07, 2.13442379251642e-07, 2.20942551347594e-07,
    2.28706173092475e-07, 2.36742493670648e-07, 2.45061086764967e-07, 2.53671861931006e-07, 2.62585076369521e-07, 2.71811347110989e-07, 2.81361663626691e-07,
    2.91247400881179e-07, 3.01480332841622e-07, 3.12072646459915e-07, 3.23036956144146e-07, 3.34386318736446e-07, 3.46134249014967e-07, 3.58294735738252e-07,
    3.70882258250978e-07, 3.83911803670617e-07, 3.97398884675396e-07, 4.11359557914439e-07, 4.25810443061903e-07, 4.40768742537532e-07, 4.56252261916931e-07,
    4.72279431055604e-07, 4.88869325951676e-07, 5.06041691373084e-07, 5.23816964275920e-07, 5.42216298041478e-07, 5.61261587560645e-07, 5.80975495195135e-07,
    6.01381477646160e-07, 6.22503813762210e-07, 6.44367633318683e-07, 6.66998946803201e-07, 6.90424676241788e-07, 7.14672687102082e-07, 7.39771821311164e-07,
    7.65751931426905e-07, 7.92643916002946e-07, 8.20479756188955e-07, 8.49292553609229e-07, 8.79116569564064e-07, 9.09987265600142e-07, 9.41941345497435e-07,
    9.75016798722140e-07, 1.00925294539651e-06, 1.04469048283858e-06, 1.08137153372628e-06, 1.11933969594263e-06, 1.15864009416037e-06, 1.19931943322670e-06,
    1.24142605341074e-06, 1.28500998757834e-06, 1.33012302036166e-06, 1.37681874939248e-06, 1.42515264867131e-06, 1.47518213414650e-06, 1.52696663158008e-06,
    1.58056764677996e-06, 1.63604883828071e-06, 1.69347609255798e-06, 1.75291760186459e-06, 1.81444394477949e-06, 1.87812816956368e-06, 1.94404588042072e-06,
    2.01227532676260e-06, 2.08289749558542e-06, 2.15599620706273e-06, 2.23165821346837e-06, 2.30997330154424e-06, 2.39103439843261e-06, 2.47493768129661e-06,
    2.56178269075688e-06, 2.65167244827677e-06, 2.74471357763284e-06, 2.84101643061262e-06, 2.94069521708582e-06, 3.04386813960092e-06, 3.15065753266368e-06,
    3.26119000685995e-06, 3.37559659799057e-06, 3.49401292139194e-06, 3.61657933162184e-06, 3.74344108769620e-06, 3.87474852406910e-06, 4.01065722755479e-06,
    4.15132822039700e-06, 4.29692814969868e-06, 4.44762948343189e-06, 4.60361071325545e-06, 4.76505656437576e-06, 4.93215821269413e-06, 5.10511350949273e-06,
    5.28412721391933e-06, 5.46941123354037e-06, 5.66118487324113e-06, 5.85967509276096e-06, 6.06511677316213e-06, 6.27775299253994e-06, 6.49783531129383e-06,
    6.72562406728870e-06, 6.96138868124762e-06, 7.20540797272926e-06, 7.45797048705416e-06, 7.71937483355792e-06, 7.98993003556115e-06, 8.26995589245995e-06,
    8.55978335435446e-06, 8.85975490964696e-06, 9.17022498605617e-06, 9.49156036550942e-06, 9.82414061338988e-06, 1.01683585226331e-05, 1.05246205731830e-05,
    1.08933474073354e-05, 1.12749743215151e-05, 1.16699517750521e-05, 1.20787459165381e-05, 1.25018391283707e-05, 1.29397305901061e-05, 1.33929368612685e-05,
    1.38619924842815e-05, 1.43474506082135e-05, 1.48498836340491e-05, 1.53698838822254e-05, 1.59080642831954e-05, 1.64650590918076e-05, 1.70415246263177e-05,
    1.76381400328741e-05, 1.82556080763503e-05, 1.88946559584256e-05, 1.95560361638440e-05, 2.02405273358169e-05, 2.09489351815637e-05, 2.16820934090207e-05,
    2.24408646957819e-05, 2.32261416913735e-05, 2.40388480539969e-05, 2.48799395229182e-05, 2.57504050277188e-05, 2.66512678356627e-05, 2.75835867384806e-05,
    2.85484572799116e-05, 2.95470130253914e-05, 3.05804268753202e-05, 3.16499124233928e-05, 3.27567253615238e-05, 3.39021649329502e-05, 3.50875754351492e-05,
    3.63143477742624e-05, 3.75839210727738e-05, 3.88977843322504e-05, 4.02574781530098e-05, 4.16645965126472e-05, 4.31207886054139e-05, 4.46277607445092e-05,
    4.61872783294148e-05, 4.78011678804717e-05, 4.94713191429751e-05, 5.11996872631348e-05, 5.29882950383297e-05, 5.48392352441665e-05, 5.67546730409316e-05,
    5.87368484621157e-05, 6.07880789877794e-05, 6.29107622056145e-05, 6.51073785626586e-05, 6.73804942107107e-05, 6.97327639486016e-05, 7.21669342645744e-05,
    7.46858464821396e-05, 7.72924400128783e-05, 7.99897557197842e-05, 8.27809393948496e-05, 8.56692453547283e-05, 8.86580401584276e-05, 9.17508064511160e-05,
    9.49511469382667e-05, 9.82627884944949e-05, 1.01689586411586e-04, 1.05235528790371e-04, 1.08904741081235e-04, 1.12701490778235e-04, 1.16630192271924e-04,
    1.20695411866187e-04, 1.24901872964529e-04, 1.29254461431464e-04, 1.33758231134814e-04, 1.38418409674930e-04, 1.43240404307037e-04, 1.48229808063103e-04,
    1.53392406079840e-04, 1.58734182139678e-04, 1.64261325431721e-04, 1.69980237540004e-04, 1.75897539666505e-04, 1.82020080096704e-04, 1.88354941915656e-04,
    1.94909450982836e-04, 2.01691184174290e-04, 2.08707977900850e-04, 2.15967936911517e-04, 2.23479443391345e-04, 2.31251166363502e-04, 2.39292071405463e-04,
    2.47611430689623e-04, 2.56218833358937e-04, 2.65124196248536e-04, 2.74337774964600e-04, 2.83870175332147e-04, 2.93732365223758e-04, 3.03935686781609e-04,
    3.14491869045623e-04, 3.25413041000914e-04, 3.36711745058115e-04, 3.48400950980631e-04, 3.60494070273268e-04, 3.73004971047161e-04, 3.85947993376367e-04,
    3.99337965161992e-04, 4.13190218520198e-04, 4.27520606710934e-04, 4.42345521624786e-04, 4.57681911845836e-04, 4.73547301309011e-04, 4.89959808570940e-04,
    5.06938166713939e-04, 5.24501743903342e-04, 5.42670564618992e-04, 5.61465331582384e-04, 5.80907448401556e-04, 6.01019042956527e-04, 6.21822991548760e-04,
    6.43342943838848e-04, 6.65603348597312e-04, 6.88629480294212e-04, 7.12447466553979e-04, 7.37084316502709e-04, 7.62567950035948e-04, 7.88927228035836e-04,
    8.16191983567356e-04, 8.44393054084268e-04, 8.73562314676266e-04, 9.03732712389774e-04, 9.34938301655777e-04, 9.67214280859060e-04, 1.00059703008421e-03,
    1.03512415007477e-03, 1.07083450244304e-03, 1.10776825116900e-03, 1.14596690542798e-03, 1.18547336378799e-03, 1.22633195981845e-03, 1.26858850915365e-03,
    1.31229035805515e-03, 1.35748643351889e-03, 1.40422729497371e-03, 1.45256518761977e-03, 1.50255409745613e-03, 1.55424980804873e-03, 1.60770995909090e-03,
    1.66299410681035e-03, 1.72016378627785e-03, 1.77928257567443e-03, 1.84041616257545e-03, 1.90363241231138e-03, 1.96900143846704e-03, 2.03659567558217e-03,
    2.10648995411860e-03, 2.17876157776023e-03, 2.25349040311453e-03, 2.33075892188550e-03, 2.41065234559014e-03, 2.49325869289236e-03, 2.57866887963004e-03,
    2.66697681161292e-03, 2.75827948027115e-03, 2.85267706123606e-03, 2.95027301593707e-03, 3.05117419630044e-03, 3.15549095263805e-03, 3.26333724481618e-03,
    3.37483075679681e-03, 3.49009301464596e-03, 3.60924950810594e-03, 3.73242981583070e-03, 3.85976773438595e-03, 3.99140141111766e-03, 4.12747348099557e-03,
    4.26813120754027e-03, 4.41352662794518e-03, 4.56381670250706e-03, 4.71916346848142e-03, 4.87973419848166e-03, 5.04570156354323e-03, 5.21724380097691e-03,
    5.39454488713786e-03, 5.57779471523967e-03, 5.76718927834550e-03, 5.96293085767073e-03, 6.16522821633469e-03, 6.37429679870144e-03, 6.59035893545221e-03,
    6.81364405453519e-03, 7.04438889814084e-03, 7.28283774585337e-03, 7.52924264413235e-03, 7.78386364228060e-03, 8.04696903505724e-03, 8.31883561209779e-03,
    8.59974891430546e-03, 8.89000349738050e-03, 9.18990320265718e-03, 9.49976143542029e-03, 9.81990145087566e-03, 1.01506566479516e-02, 1.04923708711103e-02,
    1.08453987203512e-02, 1.12101058695895e-02, 1.15868693935958e-02, 1.19760781036851e-02, 1.23781328923445e-02, 1.27934470869910e-02, 1.32224468130541e-02,
    1.36655713665753e-02, 1.41232735965236e-02, 1.45960202970225e-02, 1.50842926096873e-02, 1.55885864362723e-02, 1.61094128618282e-02, 1.66472985885689e-02,
    1.72027863806495e-02, 1.77764355200550e-02, 1.83688222738014e-02, 1.89805403726470e-02, 1.96122015015137e-02, 2.02644358018161e-02, 2.09378923858932e-02,
    2.16332398637377e-02, 2.23511668822141e-02, 2.30923826769541e-02, 2.38576176371161e-02, 2.46476238831900e-02, 2.54631758580253e-02, 2.63050709312564e-02,
    2.71741300172925e-02, 2.80711982070352e-02, 2.89971454134789e-02, 2.99528670313441e-02, 3.09392846108839e-02, 3.19573465459972e-02, 3.30080287767721e-02,
    3.40923355065740e-02, 3.52112999337807e-02, 3.63659849982569e-02, 3.75574841426474e-02, 3.87869220885535e-02, 4.00554556276456e-02, 4.13642744277471e-02,
    4.27146018539095e-02, 4.41076958044799e-02, 4.55448495621449e-02, 4.70273926599137e-02, 4.85566917619827e-02, 5.01341515593992e-02, 5.17612156804229e-02,
    5.34393676154511e-02, 5.51701316563546e-02, 5.69550738500361e-02, 5.87958029659970e-02, 6.06939714776659e-02, 6.26512765572071e-02, 6.46694610834948e-02,
    6.67503146628993e-02, 6.88956746624944e-02, 7.11074272552520e-02, 7.33875084767499e-02, 7.57379052928707e-02, 7.81606566779246e-02, 8.06578547025780e-02,
    8.32316456309191e-02, 8.58842310259361e-02, 8.86178688626283e-02, 9.14348746479108e-02, 9.43376225464109e-02, 9.73285465111919e-02, 1.00410141418370e-01,
    1.03584964204525e-01, 1.06855635005723e-01, 1.10224838296911e-01, 1.13695324030349e-01, 1.17269908771657e-01, 1.20951476832014e-01, 1.24742981394887e-01,
    1.28647445635651e-01, 1.32667963832309e-01, 1.36807702465465e-01, 1.41069901305575e-01, 1.45457874485415e-01, 1.49975011555587e-01, 1.54624778520787e-01,
    1.59410718854428e-01, 1.64336454489113e-01, 1.69405686780319e-01, 1.74622197440541e-01, 1.79989849441014e-01, 1.85512587877999e-01, 1.91194440800491e-01,
    1.97039519996076e-01, 2.03052021731523e-01, 2.09236227444542e-01, 2.15596504383031e-01, 2.22137306187946e-01, 2.28863173415821e-01, 2.35778733996782e-01,
    2.42888703623772e-01, 2.50197886068534e-01, 2.57711173419756e-01, 2.65433546238609e-01, 2.73370073626786e-01, 2.81525913201944e-01, 2.89906310975340e-01,
    2.98516601126274e-01, 3.07362205667779e-01, 3.16448633997892e-01, 3.25781482330624e-01, 3.35366433000646e-01, 3.45209253635543e-01, 3.55315796189326e-01,
    3.65691995830777e-01, 3.76343869680051e-01, 3.87277515386832e-01, 3.98499109543214e-01, 4.10014905924358e-01, 4.21831233549873e-01, 4.33954494558766e-01,
    4.46391161890698e-01, 4.59147776766241e-01, 4.72230945958719e-01, 4.85647338850183e-01, 4.99403684264039e-01, 5.13506767066788e-01, 5.27963424531367e-01,
    5.42780542454548e-01, 5.57965051020930e-01, 5.73523920406038e-01, 5.89464156111194e-01, 6.05792794022846e-01, 6.22516895189209e-01, 6.39643540307195e-01,
    6.57179823912781e-01, 6.75132848268197e-01, 6.93509716939493e-01, 7.12317528058392e-01, 7.31563367262557e-01, 7.51254300308801e-01, 7.71397365354136e-01,
    7.91999564899932e-01, 8.13067857394990e-01, 8.34609148493775e-01, 8.56630281966636e-01, 8.79138030259433e-01, 9.02139084700634e-01, 9.25640045354616e-01,
    9.49647410520714e-01, 9.74167565878274e-01, 9.99206773278894e-01, 1.02477115918791e+00, 1.05086670277814e+00, 1.07749922367995e+00, 1.10467436939280e+00,
    1.13239760236443e+00, 1.16067418674529e+00, 1.18950917482685e+00, 1.21890739317384e+00, 1.24887342846178e+00, 1.27941161303279e+00, 1.31052601018375e+00,
    1.34222039920300e+00, 1.37449826017266e+00, 1.40736275855609e+00, 1.44081672959093e+00, 1.47486266251049e+00, 1.50950268461780e+00, 1.54473854523840e+00,
    1.58057159957993e+00, 1.61700279252848e+00, 1.65403264241345e+00, 1.69166122477476e+00, 1.72988815616806e+00, 1.76871257804559e+00, 1.80813314075242e+00,
    1.84814798767948e+00, 1.88875473961696e+00, 1.92995047935341e+00, 1.97173173656780e+00, 2.01409447306359e+00, 2.05703406839551e+00, 2.10054530594169e+00,
    2.14462235947509e+00, 2.18925878028977e+00, 2.23444748493909e+00, 2.28018074364399e+00, 2.32645016943064e+00, 2.37324670805803e+00, 2.42056062879638e+00,
    2.46838151611838e+00, 2.51669826236542e+00, 2.56549906145127e+00, 2.61477140366571e+00, 2.66450207164031e+00, 2.71467713753823e+00, 2.76528196152881e+00,
    2.81630119160717e+00, 2.86771876481717e+00, 2.91951790993492e+00, 2.97168115166766e+00, 3.02419031642079e+00, 3.07702653968307e+00, 3.13017027507707e+00,
    3.18360130511856e+00, 3.23729875372481e+00, 3.29124110050777e+00, 3.34540619688355e+00, 3.39977128402485e+00, 3.45431301267792e+00, 3.50900746485977e+00,
    3.56383017744594e+00, 3.61875616765239e+00, 3.67375996040884e+00, 3.72881561761402e+00, 3.78389676925571e+00, 3.83897664637159e+00, 3.89402811581860e+00,
    3.94902371681107e+00, 4.00393569917937e+00, 4.05873606329279e+00, 4.11339660158172e+00, 4.16788894158588e+00, 4.22218459044657e+00, 4.27625498075265e+00,
    4.33007151764095e+00, 4.38360562704402e+00, 4.43682880496914e+00, 4.48971266768508e+00, 4.54222900268474e+00, 4.59434982028456e+00, 4.64604740571434e+00,
    4.69729437154437e+00, 4.74806371029043e+00, 4.79832884703162e+00, 4.84806369187073e+00, 4.89724269206236e+00, 4.94584088363031e+00, 4.99383394229257e+00,
    5.04119823351004e+00, 5.08791086147381e+00, 5.13394971684510e+00, 5.17929352306247e+00, 5.22392188103236e+00, 5.26781531202110e+00, 5.31095529857009e+00,
    5.35332432326001e+00, 5.39490590515549e+00, 5.43568463376779e+00, 5.47564620038082e+00, 5.51477742659378e+00, 5.55306628994357e+00, 5.59050194648012e+00,
    5.62707475017939e+00, 5.66277626909057e+00, 5.69759929812736e+00, 5.73153786842674e+00, 5.76458725321315e+00, 5.79674397012108e+00, 5.82800577994463e+00,
    5.85837168179866e+00, 5.88784190469273e+00, 5.91641789553545e+00, 5.94410230360389e+00, 5.97089896152959e+00, 5.99681286286937e+00, 6.02185013634606e+00,
    6.04601801686044e+00, 6.06932481339164e+00, 6.09177987391900e+00, 6.11339354751274e+00, 6.13417714375537e+00, 6.15414288966877e+00, 6.17330388433402e+00,
    6.19167405140297e+00, 6.20926808970974e+00, 6.22610142220029e+00, 6.24219014340501e+00, 6.25755096568618e+00, 6.27220116449676e+00, 6.28615852289063e+00,
    6.29944127552623e+00, 6.31206805240621e+00, 6.32405782259477e+00, 6.33542983815165e+00, 6.34620357851803e+00, 6.35639869558413e+00, 6.36603495966142e+00,
    6.37513220657418e+00, 6.38371028607596e+00, 6.39178901178538e+00, 6.39938811282442e+00, 6.40652718732905e+00, 6.41322565798880e+00, 6.41950272975688e+00,
    6.42537734985744e+00, 6.43086817020084e+00, 6.43599351230119e+00, 6.44077133477438e+00, 6.44521920347744e+00, 6.44935426433404e+00, 6.45319321887355e+00,
    6.45675230249514e+00, 6.46004726545201e+00, 6.46309335653540e+00, 6.46590530942274e+00, 6.46849733164024e+00, 6.47088309607648e+00, 6.47307573497091e+00,
    6.47508783628958e+00, 6.47693144238959e+00, 6.47861805086445e+00, 6.48015861745371e+00, 6.48156356089346e+00, 6.48284276957784e+00, 6.48400560989704e+00,
    6.48506093611363e+00, 6.48601710163659e+00, 6.48688197155099e+00, 6.48766293626142e+00, 6.48836692610774e+00, 6.48900042681414e+00, 6.48956949563502e+00,
    6.49007977806523e+00, 6.49053652498664e+00, 6.49094461012855e+00, 6.49130854772528e+00, 6.49163251026077e+00, 6.49192034619726e+00, 6.49217559759228e+00,
    6.49240151751581e+00, 6.49260108718763e+00, 6.49277703276245e+00, 6.49293184169874e+00, 6.49306777865483e+00, 6.49318690086394e+00, 6.49329107294732e+00,
    6.49338198113189e+00, 6.49346114684619e+00, 6.49352993967492e+00, 6.49358958965870e+00, 6.49364119893183e+00, 6.49368575269588e+00, 6.49372412953239e+00,
    6.49375711106216e+00, 6.49378539096283e+00, 6.49380958335986e+00, 6.49383023060923e+00, 6.49384781049274e+00, 6.49386274284900e+00, 6.49387539566481e+00,
    6.49388609065317e+00, 6.49389510834490e+00, 6.49390269272173e+00, 6.49390905541861e+00, 6.49391437952340e+00, 6.49391882300165e+00, 6.49392252177350e+00,
    6.49392559246948e+00, 6.49392813489069e+00, 6.49393023419818e+00, 6.49393196285498e+00, 6.49393338234328e+00, 6.49393454467786e+00, 6.49393549373558e+00,
    6.49393626641951e+00, 6.49393689367490e+00, 6.49393740137299e+00, 6.49393781107719e+00, 6.49393814070514e+00, 6.49393840509889e+00, 6.49393861651425e+00,
    6.49393878503932e+00, 6.49393891895129e+00, 6.49393902501951e+00, 6.49393910876205e+00, 6.49393917466206e+00, 6.49393922634975e+00, 6.49393926675467e+00,
    6.49393929823287e+00, 6.49393932267266e+00, 6.49393934158212e+00, 6.49393935616146e+00, 6.49393936736243e+00, 6.49393937593705e+00, 6.49393938247736e+00,
    6.49393938744770e+00, 6.49393939121092e+00, 6.49393939404951e+00, 6.49393939618253e+00, 6.49393939777921e+00, 6.49393939896976e+00, 6.49393939985400e+00,
    6.49393940050813e+00, 6.49393940099009e+00, 6.49393940134375e+00, 6.49393940160220e+00, 6.49393940179028e+00, 6.49393940192658e+00, 6.49393940202494e+00,
    6.49393940209560e+00, 6.49393940214616e+00, 6.49393940218216e+00, 6.49393940220769e+00, 6.49393940222570e+00, 6.49393940223836e+00, 6.49393940224722e+00,
    6.49393940225338e+00, 6.49393940225765e+00, 6.49393940226059e+00, 6.49393940226261e+00, 6.49393940226399e+00, 6.49393940226493e+00, 6.49393940226557e+00,
    6.49393940226599e+00, 6.49393940226628e+00, 6.49393940226647e+00, 6.49393940226659e+00, 6.49393940226668e+00, 6.49393940226673e+00, 6.49393940226676e+00,
    6.49393940226679e+00, 6.49393940226680e+00, 6.49393940226681e+00, 6.49393940226682e+00, 6.49393940226682e+00, 6.49393940226682e+00, 6.49393940226683e+00,
    6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00,
    6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00,
    6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00,
    6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00,
    6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00,
    6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00,
    6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00,
    6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00,
    6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00,
    6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00, 6.49393940226683e+00};

AMREX_GPU_HOST_DEVICE AMREX_FORCE_INLINE auto planck_small_x(Real x) -> Real
{
  // return x * x * x / 3.0;    // 1st order
  return (-4 + x) * x + 8 * std::log((2 + x) / 2);    // 2nd order
}

AMREX_GPU_HOST_DEVICE AMREX_FORCE_INLINE auto amrex_binary_search_with_guess(const int key, amrex::GpuArray<amrex::Real, INTERP_SIZE> const &arr, int len, int guess)
{
	int imin = 0;
	int imax = len;

	/* Handle keys outside of the arr range first */
	if (key > arr[len - 1]) {
		return len;
	} else if (key < arr[0]) {
		return -1;
	}

	/*
	 * If len <= 4 use linear search.
	 * From above we know key >= arr[0] when we start.
	 */
	if (len <= 4) {
		int i;

		for (i = 1; i < len && key >= arr[i]; ++i)
			;
		return i - 1;
	}

	if (guess > len - 3) {
		guess = len - 3;
	}
	if (guess < 1) {
		guess = 1;
	}

	/* check most likely values: guess - 1, guess, guess + 1 */
	if (key < arr[guess]) {
		if (key < arr[guess - 1]) {
			imax = guess - 1;
			/* last attempt to restrict search to items in cache */
			if (guess > LIKELY_IN_CACHE_SIZE && key >= arr[guess - LIKELY_IN_CACHE_SIZE]) {
				imin = guess - LIKELY_IN_CACHE_SIZE;
			}
		} else {
			/* key >= arr[guess - 1] */
			return guess - 1;
		}
	} else {
		/* key >= arr[guess] */
		if (key < arr[guess + 1]) {
			return guess;
		} else {
			/* key >= arr[guess + 1] */
			if (key < arr[guess + 2]) {
				return guess + 1;
			} else {
				/* key >= arr[guess + 2] */
				imin = guess + 2;
				/* last attempt to restrict search to items in
				 * cache */
				if (guess < len - LIKELY_IN_CACHE_SIZE - 1 && key < arr[guess + LIKELY_IN_CACHE_SIZE]) {
					imax = guess + LIKELY_IN_CACHE_SIZE;
				}
			}
		}
	}

	/* finally, find index by bisection */
	while (imin < imax) {
		const int imid = imin + ((imax - imin) >> 1);
		if (key >= arr[imid]) {
			imin = imid + 1;
		} else {
			imax = imid;
		}
	}
	return imin - 1;
}

AMREX_GPU_HOST_DEVICE AMREX_FORCE_INLINE auto amrex_interpolate_value(Real x, amrex::GpuArray<double, INTERP_SIZE> const &arr_x, amrex::GpuArray<double, INTERP_SIZE> const &arr_y)
{
	/* Note: arr_x must be sorted in ascending order,
		and arr_len must be >= 3. */

	int j = 0;
	int arr_len = INTERP_SIZE;
	j = amrex_binary_search_with_guess(x, arr_x, arr_len, j);

	double y = NAN;
	if (j == -1) {
		y = NAN;
	} else if (j == arr_len) {
		y = NAN;
	} else if (j == arr_len - 1) {
		y = arr_y[j];
	} else if (x == arr_x[j]) { // avoid roundoff error
		y = arr_y[j];
	} else {
		const double slope = (arr_y[j + 1] - arr_y[j]) / (arr_x[j + 1] - arr_x[j]);
		y = slope * (x - arr_x[j]) + arr_y[j];
	}
	assert(!isnan(y));
	return y;
}

// AMREX_GPU_HOST_DEVICE AMREX_FORCE_INLINE auto integral_planck_from_0_to_x(quokka::valarray x, amrex::GpuArray <Real, N> const &X, amrex::GpuArray <Real, N> const &Y, const int X_length) -> Real

// Integrate the Planck integral, x^3 / (exp(x) - 1), from 0 to x. Return its ratio to the integral from 0 to infinity (pi^4 / 15).
AMREX_GPU_HOST_DEVICE AMREX_FORCE_INLINE auto integrate_planck_from_0_to_x(Real x) -> Real
{
  AMREX_ASSERT(x >= 0.);

  // amrex::GpuArray<double, INTERP_SIZE> const X_interp{0., 1., 10.};
  // amrex::GpuArray<double, INTERP_SIZE> const Y_interp{0., 1., gInf};

  Real y = NAN;

  if (x <= 0.) {
    y = 0.;
  } else if (x < X_interp[0]) {
    y = planck_small_x(x);
    AMREX_ASSERT(y <= Y_interp[0]);
  } else if (x > X_interp[INTERP_SIZE - 1]) {
	  y = gInf;
  } else {
	  y = amrex_interpolate_value(x, X_interp, Y_interp);
  }
  return y / gInf;
}
